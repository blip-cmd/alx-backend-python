#!/bin/bash

# Apply the updated deployment file and trigger a rolling update
echo "Applying the updated deployment file and triggering a rolling update..."
kubectl apply -f blue_deployment.yaml

# Monitor the update progress
echo "Monitoring the update progress..."
kubectl rollout status deployment django-messaging-app-blue

# Test for downtime using curl
echo "Testing for downtime using curl..."
while true; do
  curl -s -o /dev/null -w "%{http_code}\n" http://<your-cluster-ip>:80 # Replace <your-cluster-ip> with the actual ClusterIP of your service
  sleep 1
done

# Verify the rolling update is complete
echo "Verifying the rolling update is complete by checking the current pods..."
kubectl get pods -l app=django-messaging-app,version=blue
